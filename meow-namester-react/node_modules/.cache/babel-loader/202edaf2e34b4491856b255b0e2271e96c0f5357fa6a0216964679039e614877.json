{"ast":null,"code":"var _s = $RefreshSig$();\n/**\n * @module useSupabaseStorage\n * @description A custom React hook that provides persistent storage using Supabase.\n * It syncs state with Supabase and handles real-time updates.\n * \n * @example\n * // Using the hook in a component\n * const [value, setValue, { loading, error }] = useSupabaseStorage('cat_names', defaultValue);\n */\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from './supabaseClient';\nfunction useSupabaseStorage(tableName, initialValue = [], userName = '') {\n  _s();\n  const [storedValue, setStoredValue] = useState(initialValue);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    if (!userName) return;\n    fetchData();\n    const subscription = supabase.channel(`${tableName}_changes`).on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: tableName,\n      filter: `user_name=eq.${userName}`\n    }, payload => {\n      console.log('Change received!', payload);\n      fetchData();\n    }).subscribe();\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [tableName, userName]);\n  async function fetchData() {\n    try {\n      setLoading(true);\n      const {\n        data,\n        error: fetchError\n      } = await supabase.from(tableName).select('name, rating, created_at').eq('user_name', userName).order('rating', {\n        ascending: false\n      });\n      if (fetchError) throw fetchError;\n      setStoredValue(data || initialValue);\n    } catch (err) {\n      console.error('Error fetching data:', err);\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }\n  async function setValue(newValue) {\n    if (!userName) return;\n    try {\n      setLoading(true);\n      if (Array.isArray(newValue)) {\n        // Handle array updates (e.g., ranked cat names)\n        const {\n          error: upsertError\n        } = await supabase.from(tableName).upsert(newValue.map(item => ({\n          name: item.name || item,\n          rating: item.rating || 1500,\n          user_name: userName,\n          updated_at: new Date().toISOString()\n        })));\n        if (upsertError) throw upsertError;\n      } else {\n        // Handle single record updates\n        const {\n          error: upsertError\n        } = await supabase.from(tableName).upsert({\n          name: newValue.name || newValue,\n          rating: newValue.rating || 1500,\n          user_name: userName,\n          updated_at: new Date().toISOString()\n        });\n        if (upsertError) throw upsertError;\n      }\n      await fetchData(); // Refresh data after update\n    } catch (err) {\n      console.error('Error setting value:', err);\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }\n  async function clearUserData() {\n    if (!userName) return;\n    try {\n      setLoading(true);\n      const {\n        error: deleteError\n      } = await supabase.from(tableName).delete().eq('user_name', userName);\n      if (deleteError) throw deleteError;\n      setStoredValue(initialValue);\n    } catch (err) {\n      console.error('Error clearing data:', err);\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }\n  return [storedValue, setValue, {\n    loading,\n    error,\n    clearUserData\n  }];\n}\n_s(useSupabaseStorage, \"7I0FNrSbcRydL4YWfLrml+7znFU=\");\nexport default useSupabaseStorage;","map":{"version":3,"names":["useState","useEffect","supabase","useSupabaseStorage","tableName","initialValue","userName","_s","storedValue","setStoredValue","loading","setLoading","error","setError","fetchData","subscription","channel","on","event","schema","table","filter","payload","console","log","subscribe","unsubscribe","data","fetchError","from","select","eq","order","ascending","err","setValue","newValue","Array","isArray","upsertError","upsert","map","item","name","rating","user_name","updated_at","Date","toISOString","clearUserData","deleteError","delete"],"sources":["/Users/aaron/Desktop/Side Projects/name-picker/meow-namester-react/src/lib/supabase/useSupabaseStorage.js"],"sourcesContent":["/**\n * @module useSupabaseStorage\n * @description A custom React hook that provides persistent storage using Supabase.\n * It syncs state with Supabase and handles real-time updates.\n * \n * @example\n * // Using the hook in a component\n * const [value, setValue, { loading, error }] = useSupabaseStorage('cat_names', defaultValue);\n */\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from './supabaseClient';\n\nfunction useSupabaseStorage(tableName, initialValue = [], userName = '') {\n  const [storedValue, setStoredValue] = useState(initialValue);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    if (!userName) return;\n    fetchData();\n    \n    const subscription = supabase\n      .channel(`${tableName}_changes`)\n      .on('postgres_changes', \n        { \n          event: '*', \n          schema: 'public', \n          table: tableName,\n          filter: `user_name=eq.${userName}`\n        }, \n        (payload) => {\n          console.log('Change received!', payload);\n          fetchData();\n        }\n      )\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [tableName, userName]);\n\n  async function fetchData() {\n    try {\n      setLoading(true);\n      const { data, error: fetchError } = await supabase\n        .from(tableName)\n        .select('name, rating, created_at')\n        .eq('user_name', userName)\n        .order('rating', { ascending: false });\n\n      if (fetchError) throw fetchError;\n\n      setStoredValue(data || initialValue);\n    } catch (err) {\n      console.error('Error fetching data:', err);\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function setValue(newValue) {\n    if (!userName) return;\n    \n    try {\n      setLoading(true);\n      \n      if (Array.isArray(newValue)) {\n        // Handle array updates (e.g., ranked cat names)\n        const { error: upsertError } = await supabase\n          .from(tableName)\n          .upsert(\n            newValue.map(item => ({\n              name: item.name || item,\n              rating: item.rating || 1500,\n              user_name: userName,\n              updated_at: new Date().toISOString()\n            }))\n          );\n\n        if (upsertError) throw upsertError;\n      } else {\n        // Handle single record updates\n        const { error: upsertError } = await supabase\n          .from(tableName)\n          .upsert({\n            name: newValue.name || newValue,\n            rating: newValue.rating || 1500,\n            user_name: userName,\n            updated_at: new Date().toISOString()\n          });\n\n        if (upsertError) throw upsertError;\n      }\n\n      await fetchData(); // Refresh data after update\n    } catch (err) {\n      console.error('Error setting value:', err);\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function clearUserData() {\n    if (!userName) return;\n    \n    try {\n      setLoading(true);\n      const { error: deleteError } = await supabase\n        .from(tableName)\n        .delete()\n        .eq('user_name', userName);\n\n      if (deleteError) throw deleteError;\n      setStoredValue(initialValue);\n    } catch (err) {\n      console.error('Error clearing data:', err);\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return [storedValue, setValue, { loading, error, clearUserData }];\n}\n\nexport default useSupabaseStorage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}